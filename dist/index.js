const t={select:"get",insert:"post",update:"put",delete:"delete"},e=/,/gi;function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function r(t){var e=function(t,e){if("object"!=n(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var o=r.call(t,e);if("object"!=n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==n(e)?e:e+""}function o(t,e,n){return(e=r(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}let i,s,a=new Map;function u(t){i=t,a=new Map}const c={get apiUrl(){return i.apiUrl},get options(){return i.options||{}},getNestedRoute(t,e){var n;if(null!==(n=i)&&void 0!==n&&n.pathMap){const n=i.pathMap[t];return n?function(t,e){if(!e)throw new Error("You cannot query a nested route without a conditional clause (e.g., WHERE clause)");const n=function(t){const e=t.match(l)||[t];return e.map(t=>t.replace(f,""))}(t);return n.reduce((t,n)=>t.replace(`{${n}}`,e[n]),t)}(n,e):n}},dataExtractor:t=>i.dataExtractor?i.dataExtractor(t):t,refresh(t){i.refresh(t).then(t=>{i.options.headers=t})},hasRefresh:()=>i.hasOwnProperty("refresh"),getPolicy(t){var e;return t&&null!==(e=i[t])&&void 0!==e&&e.policy?i[t].policy:i.policy},hasPolicy(t){const e="policy";return i[t]&&i[t].hasOwnProperty(e)||i.hasOwnProperty(e)},hasCancel:()=>i.canCancel,set cancel(t){i.cancelController=t},hasDebug:()=>Boolean(i.debug),hasNodeProvider:()=>i.hasOwnProperty("nodeProvider"),getNodeProvider:()=>i.nodeProvider,hasAddons:()=>i.hasOwnProperty("addons"),getAddons:()=>(s||(s=i.addons.map(t=>(t.queryParser=t.queryParser.bind(t),t.resultSetFilter=t.resultSetFilter.bind(t),t))),s||[]),get path(){return i.path||{url:"",config:{}}},hasPagination:()=>Boolean(i&&i.paginationToken),getPaginationSpec:()=>i.paginationToken||{},getPaginationParamName(){const t=this.getPaginationSpec();return t.param||t.requestParam||"paginationToken"},buildPaginationKey(t,e,n){if(!e)return t;const r=e.split("&").filter(t=>!t.startsWith(`${n}=`));r.sort();const o=r.join("&");return o?`${t}?${o}`:t},getPaginationState:t=>a.get(t),setPaginationState(t,e){a.set(t,e)},clearPaginationState(t){a.delete(t)},hasMore(t){const e=a.get(t);return Boolean(e&&e.hasMore)},extractNextToken(t,e,n){const r=this.getPaginationSpec(),o=(t,e)=>{if(!t||!e)return;const n=e.split(".");let r=t;for(let t=0;t<n.length;t++){const e=n[t];if(!r||!Object.prototype.hasOwnProperty.call(r,e))return;r=r[e]}return r};if("function"==typeof r.responsePath)try{return r.responsePath({data:t,extracted:e,headers:n})}catch(t){return}let i;return r.responseHeader&&n&&"function"==typeof n.get&&(i=n.get(r.responseHeader),i)||r.responsePath&&(i=o(t,r.responsePath),null==i&&e&&e!==t&&(i=o(e,r.responsePath))),i}};const l=/{(.*?)}/g,f=/[{}]/g;function p(t){return Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])}).join("&")}function d(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function y(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?d(Object(n),!0).forEach(function(e){o(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}const h="object"==typeof process&&"object"==typeof process.versions&&void 0!==process.versions.node,g={get:(t,e)=>b(t,"GET",e),put:(t,e)=>b(t,"PUT",e),post:(t,e)=>b(t,"POST",e),delete:t=>b(t,"DELETE")};function m(t){return h&&c.hasNodeProvider()?(e=function(t){return c.hasDebug()&&P(t,y(y({method:t.method},t.body?{body:JSON.stringify(t.body)}:{}),t.headers?{headers:t.headers}:{})),c.getNodeProvider()}(t),async function(t,n=0,r,o){try{const i=await e(t,n,r,o);if(null!=r&&r.hasPagination&&r.hasPagination()&&t.__paginationKey){const e=v(t,i.data,i.data,void 0);return y(y({},i),{},{data:e})}return i}catch(e){try{return await O(t,n,r,o)}catch(t){throw e}}}):O;var e}function b(t,e,n){const r=n&&"GET"===e,{host:o,options:i}=function(t){const e=c.path.hasOwnProperty(t),n=function(t){return t&&t.length>1&&t.endsWith("/")?t.slice(0,-1):t}(e&&e.url||c.apiUrl);return{host:n,options:e&&e.options||c.options}}(t),s=r?function(t,e,n){if(!c.hasPagination())return{finalData:e};const r=c.getPaginationParamName(),o=p(e||{}),i=`${n}/${t}`,s=c.buildPaginationKey(i,o,r),a=c.getPaginationState(s);return{finalData:a&&a.token?y(y({},e||{}),{},{[r]:a.token}):e,paginationKey:s,paginationParam:r}}(t,n,o):{},a=function({url:t,method:e,data:n,finalData:r,host:o,options:i,pagination:s,isGetData:a}){const u=y(y({method:e,url:`${o}/${t}${a?`?${p(r)}`:""}`,json:!0},a?{}:{body:n}),i);return s&&s.paginationKey&&(u.__paginationKey=s.paginationKey,u.__paginationParam=s.paginationParam),u}({url:t,method:e,data:n,finalData:s.finalData||n,host:o,options:i,pagination:s,isGetData:r});return function(t,e,n){const r=()=>t(e,0,c,n);return c.hasPolicy(n)?c.getPolicy(n).execute(r):r()}(m(a),a,t)}function v(t,e,n,r){try{const o=t.__paginationKey,i=t.__paginationParam,s=c.getPaginationState(o),a=c.extractNextToken(e,n,r);return a?(c.setPaginationState(o,{token:a,hasMore:!0,param:i}),n):s&&s.token?(c.clearPaginationState(o),Array.isArray(n),[]):n}catch(t){return n}}function P(t,e){console.log("[querty][debug] api request:",{url:t.url,options:e})}async function O(t,e=0,n,r){const o=function(t){let e,n;return c.hasCancel()&&(e=new AbortController,n=e.signal,c.cancel=e),y(y(y({method:t.method},n?{signal:n}:{}),t.body?{body:JSON.stringify(t.body)}:{}),t.headers?{headers:t.headers}:{})}(t);!function(t,e){if(c.hasDebug()){const n=y({},t);n.signal&&(n.signal="[AbortSignal]"),P(e,n)}}(o,t);const i=await fetch(t.url,o);if(function(t,e){return 401===t&&0===e&&c.hasRefresh()}(i.status,e)){const e=await async function(t,e){await c.refresh(e);const n=c.path.hasOwnProperty(e),r=n&&n.options||c.options;return y(y({},t),{},{headers:r.headers})}(t,r);return O(e,1,n,r)}return async function(t,e){const n=await t.json();let r=c.dataExtractor(n);return c.hasPagination()&&e.__paginationKey&&(r=v(e,n,r,t.headers)),{status:t.status,data:r}}(i,t)}function j(t){return t.trim()}function S(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function w(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?S(Object(n),!0).forEach(function(e){o(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):S(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}const E=/[()']/g,A=/\bJOIN\b|\bLEFT\s+JOIN\b|\bFULL\s+JOIN\b/gi,N=/\bJOIN\b|\bLEFT\s+JOIN\b|\bFULL\s+JOIN\b|\bON\b/i;function D(t){const{fieldsStr:e,fromSegment:n,whereSegment:r,groupByStr:o,havingStr:i,orderByStr:s}=function(t){const e=new RegExp([/^\s*SELECT\s+([\s\S]*?)/,/\s+FROM\s+([\s\S]*?)/,/(?:\s+WHERE\s+([\s\S]*?))?/,/(?:\s+GROUP\s+BY\s+([\s\S]*?))?/,/(?:\s+HAVING\s+([\s\S]*?))?/,/(?:\s+ORDER\s+BY\s+([\s\S]*?))?\s*$/].map(t=>t.source).join(""),"i"),n=t.match(e);if(!n)throw new Error("Invalid or unsupported SELECT query format");const r=(n[1]||"").trim(),o=(n[2]||"").trim(),i=n[3]?n[3].trim():void 0,s=n[4]?n[4].trim():void 0,a=n[5]?n[5].trim():void 0,u=n[6]?n[6].trim():void 0;return{fieldsStr:r,fromSegment:o,whereSegment:i,groupByStr:s,havingStr:a,orderByStr:u}}(t),a=function(t){return L(t)}(e),u=function(t){return t?L(t):void 0}(o),c=function(t){if(!t)return;const e=t.split(",").map(t=>t.trim()).filter(Boolean);return e.map(t=>{var e;const n=t.split(/\s+/).filter(Boolean),r=null===(e=n[n.length-1])||void 0===e?void 0:e.toUpperCase();let o="ASC";"ASC"!==r&&"DESC"!==r||(n.pop(),o=r);return{field:n.join(" ").trim(),direction:o}})}(s),{joinMatch:l,tables:f,joinCond:p,join:d}=function(t){const e=t.match(A);if(e){const[n,...r]=t.split(N),{joinTables:o,clauses:i}=r.reduce((t,e,n)=>(t[n%2==0?"joinTables":"clauses"].push(e.trim()),t),{joinTables:[n.trim()],clauses:[]});return{joinMatch:e,tables:o.map(j),joinCond:function(t){const e=[];for(let n=0;n<t.length;n++){const r=t[n],[o,i]=r.split("="),[,s]=o.split(".").map(j),[,a]=i.split(".").map(j);e.push([s,a])}return e}(i),join:e}}return{joinMatch:null,tables:t,joinCond:void 0,join:void 0}}(n),y=function(t){let e,n;if(t&&t.length>0){const r=t.match(/^(.*?)\s+IN\s*\(([\s\S]*?)\)\s*$/i);if(r){return{field:r[1].trim(),operator:"IN",values:$(`(${r[2].trim()})`)}}const o=t.indexOf("=");-1!==o&&(e=t.slice(0,o).trim(),n=t.slice(o+1).trim())}return{field:e,value:n}}(r),h=(()=>{if(!(r||l||u||i||c))return;const t={};return"IN"===(null==y?void 0:y.operator)?(t.operator="IN",t.values=y.values,y.field&&(t[y.field]=y.values)):null!=y&&y.field&&(t.value=y.value,t[y.field]=y.value),w(w({},t),{},{join:d,joinCond:p,groupBy:u,having:null==i?void 0:i.trim(),orderBy:c})})();return w({entities:l?f:L(f),fields:a},h?{conditions:h}:{})}function L(t){return t.split(",").map(j)}function T(t){const e=t.split(/INSERT INTO \b(\w+)\b|\bVALUES\b/i),n=e[2].replace(E,"").split(",").map(j);const r=$(e[4]);return{entity:e[1],data:n.reduce((t,e,n)=>(t[e]=r[n],t),{})}}function C(t){const e=new RegExp([/^s*UPDATEs+(\w+)/,/s+SETs+(.*?)/,/s+WHEREs+(.*)$/].map(t=>t.source.replace(/s/g,"\\s")).join(""),"i"),n=t.match(e);if(!n)throw new Error("Invalid or unsupported UPDATE query format");const r=n[1],o=n[2],i=n[3],s=function(t,e){return Object.fromEntries([...t.matchAll(e)].map(([,t,e,n])=>{const r=void 0!==e?e:n,o=r&&!isNaN(r)&&""!==r.trim()?Number(r):r;return[t.trim(),o]}))}(o,/(\w+)\s*=\s*(?:'([^']*)'|(\S+?))(?:,|$)/g),a=i.split("=")[1].trim();return{entity:r.trim(),data:s,id:a}}function $(t){return t.trim().slice(1,-1).split(",").map(t=>{const e=t.trim();if(e.startsWith("'")&&e.endsWith("'"))return e.slice(1,-1);if(!isNaN(e)&&""!==e.trim())return Number(e);return"null"===e.toLowerCase()?null:e})}function B(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var k,I,R,_,x,q;function M(){if(I)return k;I=1,k=function(i){return t.test(i)?i.toLowerCase():e.test(i)?(function(t){return t.replace(r,function(t,e){return e?" "+e:""})}(i)||i).toLowerCase():n.test(i)?function(t){return t.replace(o,function(t,e,n){return e+" "+n.toLowerCase().split("").join(" ")})}(i).toLowerCase():i.toLowerCase()};var t=/\s/,e=/(_|-|\.|:)/,n=/([a-z][A-Z]|[A-Z][a-z])/;var r=/[\W_]+(.|$)/g;var o=/(.)([A-Z]+)/g;return k}var U,F=B(function(){if(q)return x;q=1;var t=function(){if(_)return R;_=1;var t=M();return R=function(e){return t(e).replace(/[\W_]+(.|$)/g,function(t,e){return e?" "+e:""}).trim()}}();return x=function(e){return t(e).replace(/\s(\w)/g,function(t,e){return e.toUpperCase()})}}()),J={};var W=function(){if(U)return J;U=1,Object.defineProperty(J,"__esModule",{value:!0}),J.fullJoin=J.leftJoin=J.join=void 0;const t=(t,e)=>{const n=new Map;for(const r of t){const t=e(r);if(n.has(t)){const e=n.get(t);e.push(r),n.set(t,e)}else n.set(t,[r])}return n},e=(e,n,r,o,i,s,a)=>{const u=t(e,r);if(!a&&0===u.size)return[];const c=t(n,o);if(!s&&0===c.size)return[];const l=[];for(const t of u.keys())if(c.has(t)){const e=u.get(t),n=c.get(t);e.forEach(t=>n.forEach(e=>l.push(i(t,e))))}else if(s){u.get(t).forEach(t=>l.push(i(t,void 0)))}if(a)for(const t of c.keys())if(!u.has(t)){c.get(t).forEach(t=>l.push(i(void 0,t)))}return l};return J.join=(t,n,r,o,i)=>e(t,n,r,o,(t,e)=>i(t,e),!1,!1),J.leftJoin=(t,n,r,o,i)=>e(t,n,r,o,(t,e)=>i(t,e),!0,!1),J.fullJoin=(t,n,r,o,i)=>e(t,n,r,o,(t,e)=>i(t,e),!0,!0),J}();function K(t){return Array.isArray(t)?t:[t]}function H(...t){if(1===t.length&&Array.isArray(t[0])&&Array.isArray(t[0][0])){const e=t[0];t=e.flat()}else t.length>0&&t.every(t=>Array.isArray(t)&&2===t.length)&&(t=t.flat());return function(...e){const n=t.length%2==1,r=n?t.length-1:t.length;for(let n=0;n<r;n+=2){const r=t[n],o=t[n+1];let i=!1;if("function"==typeof r)try{i=Boolean(r.apply(this,e))}catch{i=!1}else i="else"===r||!0===r||r===H.ELSE||r===H.DEFAULT||r===H._||Boolean(r);if(i)return"function"==typeof o?o.apply(this,e):o}if(n){const n=t[t.length-1];return"function"==typeof n?n.apply(this,e):n}}}function G(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function z(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?G(Object(n),!0).forEach(function(e){o(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):G(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}H.ELSE=Symbol.for("cond.ELSE"),H.DEFAULT=H.ELSE,H._=H.ELSE;const Y="fullJoin",Z="DESC",V="IN",Q="=",X=".",tt=/\s+AS\s+/i,et="->",nt="id",rt="data",ot="*",it=t=>{const e=t.match(tt);if(!e)return[t];const n=e.index;return[t.slice(0,n).trim(),t.slice(n+e[0].length).trim()]},st=t=>it(t)[0],at=(t,e)=>{const n=z(z({},t),e);return t&&t[nt]?z(z({},n),{},{[nt]:t[nt]}):n},ut=(t,e)=>z(z({},t),e);function ct(t,e,n,r={},o){var i,s;const a=function(t,e,n,r){const o=1===t.length;return t.reduce((t,i,s)=>{const a=function(t,e,n){const r=t[e][rt];if(Array.isArray(r))return r;if(r&&"object"==typeof r&&Object.prototype.hasOwnProperty.call(r,n)){const t=r[n];return Array.isArray(t)?t:[t]}return[r]}(e,s,i),[u]=a;return t[i]=u?function(t,e,n,r,o,i){const s=yt(t,e);if(a=s,a.includes(ot))return o;var a;const u=s.map(t=>st(t)).filter(t=>t!==ot&&!t.includes(X)),c=function(t,e,n){const r=t=>"string"==typeof t&&t.includes(et);return t?[...new Set(e)]:(()=>{const t=new Set(n.flatMap(t=>t&&"object"==typeof t?Object.keys(t):[]));return[...new Set(e.filter(e=>t.has(e)||r(e)))]})()}(i,u,o),l=r?[...new Set(r.flat())]:[];return function(t,e,n){const r=function(t){return t.reduce((t,e)=>{if(tt.test(e)){const[n,r]=it(e);t[n]=r}return t},{})}(e);return n.map(e=>t.reduce((t,n)=>{if("string"==typeof(o=n)&&o.includes(et)){return t[r[n]||function(t){const e=t.match(gt);if(e)return e[2];const n=t.indexOf(et);return n>0?t.slice(0,n).trim():t}(n)]=function(t,e){const{base:n,steps:r}=function(t){const e=t.indexOf(et),n=t.slice(0,e).trim(),r=t.slice(e),o=[];let i;for(;i=ht.exec(r);)o.push({op:"->>"===i[1]?"text":"json",key:i[3]});return{base:n,steps:o}}(e);let o=t?t[n]:void 0;for(let t=0;t<r.length;t++){const{op:e,key:n}=r[t];if(null==o)return null;const i=H(()=>Array.isArray(o)&&/^\d+$/.test(n),()=>o[Number(n)],()=>o&&"object"==typeof o,()=>o[n],H.ELSE,void 0)();o=H("json"===e,i,H.ELSE,()=>null==i?null:String(i))()}return null==o?null:o}(e,n),t}var o;return t[r[n]||n]=Object.prototype.hasOwnProperty.call(e,n)?e[n]:null,t},{}))}([...c,...l],s,o)}(n,i,0,r,a,o):[],t},{})}(e,t,n,null==r?void 0:r.joinCond),u=null!=r&&r.join?function(t,e){const{join:n,joinCond:r}=t,o=Object.values(e).map(K),[i,...s]=o;return s.reduce((t,e,o)=>{const i=(s=n[o],F(s.replace(/\s/,"_")));var s;const[a,u]=r[o];var c;return((t,e,n,r,o,i)=>t(e,n,t=>t[r],t=>t[o],i))("leftJoin"===(c=i)?W.leftJoin:c===Y?W.fullJoin:W.join,t,e,a,u,o>0&&i===Y?ut:at)},i)}(r,a):a,c=[(null==r||null===(i=r.groupBy)||void 0===i?void 0:i.length)>0?t=>function(t,e,n){return t.join?function(t,e){if(!Array.isArray(t))return t;const n=e.map(t=>t.includes(X)?t.split(X)[1]:t);return dt(t,n)}(e,t.groupBy):function(t,e,n){return e.reduce((e,r)=>{const o=t[r];if(Array.isArray(o)){const t=yt(n,r).map(t=>st(t));e[r]=dt(o,t)}else e[r]=o;return e},{})}(e,n,t.groupBy)}(r,t,e):null,!(null==r||!r.having)&&(t=>function(t,e,n,r){const o=function(t){if(!t)return;const e=t.match(/^(.*?)\s+IN\s*\(([^)]*)\)\s*$/i);if(e){const t=e[1].trim(),n=e[2].trim(),r=n.split(",").map(t=>pt(t.trim()));return{field:t,operator:V,values:r}}const n=t.indexOf(Q);if(-1!==n){const e=t.slice(0,n).trim(),r=t.slice(n+1).trim();return{field:e,operator:Q,value:pt(r)}}return}(n);if(!o)return t;if(r)return function(t,e){if(!Array.isArray(t))return t;const n=e.field.includes(X)?e.field.split(X)[1]:e.field;return t.filter(t=>ft(null==t?void 0:t[n],e))}(t,o);{const n=o.field.includes(X)?o.field.split(X)[0]:null,r=o.field.includes(X)?o.field.split(X)[1]:o.field;return e.reduce((e,i)=>{const s=t[i];return e[i]=!Array.isArray(s)||n&&n!==i?s:s.filter(t=>ft(null==t?void 0:t[r],o)),e},{})}}(t,e,r.having,Boolean(r.join))),(null==r||null===(s=r.orderBy)||void 0===s?void 0:s.length)>0&&(t=>function(t,e,n,r){return r?function(t,e){if(!Array.isArray(t))return t;const n=e.map(t=>({key:t.field.includes(X)?t.field.split(X)[1]:t.field,dir:t.direction}));return lt(t.slice(),n)}(t,n):e.reduce((e,r)=>{const o=t[r];if(!Array.isArray(o))return e[r]=o,e;const i=function(t,e){return t.reduce((t,n)=>{if(n.field.includes(X)){const[r,o]=n.field.split(X);r===e&&t.push({key:o,dir:n.direction})}else t.push({key:n.field,dir:n.direction});return t},[])}(n,r);return e[r]=i.length>0?lt(o.slice(),i):o,e},{})}(t,e,r.orderBy,Boolean(r.join))),o].filter(Boolean);return c.reduce((t,e)=>e(t),u)}function lt(t,e){if(!e||0===e.length)return t;const n=(t,e,n)=>H(null==t&&null==e,0,null==t,1,null==e,-1,t<e,n===Z?1:-1,t>e,n===Z?-1:1,H.ELSE,0)();return t.sort((t,r)=>{for(let o=0;o<e.length;o++){const{key:i,dir:s}=e[o],a=null==t?void 0:t[i],u=null==r?void 0:r[i],c=n(a,u,s);if(0!==c)return c}return 0})}function ft(t,e){return e.operator===V?e.values.some(e=>e===t):String(t)===String(e.value)}function pt(t){if(!t)return t;if(t.startsWith("'")&&t.endsWith("'")||t.startsWith('"')&&t.endsWith('"'))return t.slice(1,-1);return"null"===t.toLowerCase()?null:isNaN(t)||""===t.trim()?t:Number(t)}function dt(t,e){if(!e||0===e.length)return t;const n=t.reduce((t,n)=>{const r=e.map(t=>String(null==n?void 0:n[t])).join("|#|");return t.has(r)||t.set(r,n),t},new Map);return Array.from(n.values())}function yt(t,e){return t.reduce((t,n)=>{const[r,o]=n.split(X);return t.push(r===e?o:n),t},[])}const ht=/(->>|->)\s*(["'])(.*?)\2/g;const gt=/(["'])([^"']+)\1\s*$/;const mt=(...t)=>e=>t.reduceRight((t,e)=>e(t),e);const bt={[t.select]:async function(t,e,n={}){const{queryParser:r,resultSetFilter:o}=n,{fields:i,entities:s,conditions:a}=r(D(t));return ct(await Promise.all(s.map(t=>{const n=function(t={},e){const n=c.getNestedRoute(e,t);return n||(t.value?`${e}/${t.value}`:e)}(a,t);return g.get(n,e)})),s,i,a,o)},[t.insert]:async function(t,e){const n={},{entity:r,queryData:o}=function(t,e){let n,r;if(t)n=e.replace(/INSERT INTO/i,"").trim(),r=t;else{const t=T(e);n=t.entity,r=t.data}return{entity:n,queryData:r}}(e,t),i=await g.post(r,o);return n[r]?n[r].push(i.data):n[r]=[i.data],n},[t.update]:async function(t,e){const n={},{entity:r,queryData:o,id:i}=function(t,e){let n,r,o;if(t){const[,i,s]=e.split(/UPDATE\b|\bWHERE\b/i);o=s.split("=")[1].trim(),n=i.trim(),r=t}else{const t=C(e);n=t.entity,r=t.data,o=t.id}return{entity:n,queryData:r,id:o}}(e,t),s=await g.put(`${r}/${i}`,o);return n[r]=s.data,n},[t.delete]:async function(t){const{entity:e,id:n}=function(t){const e=new RegExp([/^s*DELETEs+FROMs+(\w+)/,/s+WHEREs+(.*)$/].map(t=>t.source.replace(/s/g,"\\s")).join(""),"i"),n=t.match(e);if(!n)throw new Error("Invalid or unsupported DELETE query format");return{entity:n[1],id:n[2].split("=")[1].trim()}}(t);return await g.delete(`${e}/${n}`),{id:n}}};async function vt(n,r){const[o]=function(t){return t.replace(e,"").split(" ")}(n),i=t[o.toLowerCase()],s=function(){let t=t=>t,e=t=>t;if(c.hasAddons()){const{queryParsers:n,resultSetFilters:r}=c.getAddons().reduce((t,{queryParser:e,resultSetFilter:n})=>(t.queryParsers.push(e),t.resultSetFilters.push(n),t),{queryParsers:[],resultSetFilters:[]});t=mt(...n),e=mt(...r)}return{queryParser:t,resultSetFilter:e}}();return bt[i](n,r,s)}export{H as cond,vt as exec,u as setConfig};
