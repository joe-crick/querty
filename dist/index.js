const t={select:"get",insert:"post",update:"put",delete:"delete"},e=/,/gi;function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function r(t){var e=function(t,e){if("object"!=n(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var o=r.call(t,e);if("object"!=n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==n(e)?e:e+""}function o(t,e,n){return(e=r(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function i(...t){if(1===t.length&&Array.isArray(t[0])&&Array.isArray(t[0][0])){const e=t[0];t=e.flat()}else t.length>0&&t.every(t=>Array.isArray(t)&&2===t.length)&&(t=t.flat());return function(...e){const n=t.length%2==1,r=n?t.length-1:t.length;for(let n=0;n<r;n+=2){const r=t[n],o=t[n+1];let s=!1;if("function"==typeof r)try{s=Boolean(r.apply(this,e))}catch{s=!1}else s="else"===r||!0===r||r===i.ELSE||r===i.DEFAULT||r===i._||Boolean(r);if(s)return"function"==typeof o?o.apply(this,e):o}if(n){const n=t[t.length-1];return"function"==typeof n?n.apply(this,e):n}}}let s;i.ELSE=Symbol.for("cond.ELSE"),i.DEFAULT=i.ELSE,i._=i.ELSE;let a,u=new Map;function c(t){s=t,u=new Map}const l={get apiUrl(){return s.apiUrl},get options(){return s.options||{}},getNestedRoute(t,e){var n;if(null!==(n=s)&&void 0!==n&&n.pathMap){const n=s.pathMap[t];return n?function(t,e){if(!e)throw new Error("You cannot query a nested route without a conditional clause (e.g., WHERE clause)");const n=function(t){const e=t.match(f)||[t];return e.map(t=>t.replace(p,""))}(t);return n.reduce((t,n)=>t.replace(`{${n}}`,e[n]),t)}(n,e):n}},dataExtractor:t=>s.dataExtractor?s.dataExtractor(t):t,refresh(t){s.refresh(t).then(t=>{s.options.headers=t})},hasRefresh:()=>s.hasOwnProperty("refresh"),getPolicy(t){var e;return t&&null!==(e=s[t])&&void 0!==e&&e.policy?s[t].policy:s.policy},hasPolicy(t){const e="policy";return s[t]&&s[t].hasOwnProperty(e)||s.hasOwnProperty(e)},hasCancel:()=>s.canCancel,set cancel(t){s.cancelController=t},hasDebug(){var t;return Boolean(null===(t=s)||void 0===t?void 0:t.debug)},hasDebugResponseRaw(){var t,e;const n=null===(t=s)||void 0===t?void 0:t.debug;return Boolean((null===(e=s)||void 0===e?void 0:e.debugRawResponse)||n&&"object"==typeof n&&n.responseRaw)},hasNodeProvider:()=>s.hasOwnProperty("nodeProvider"),getNodeProvider:()=>s.nodeProvider,hasAddons:()=>s.hasOwnProperty("addons"),getAddons:()=>(a||(a=s.addons.map(t=>(t.queryParser=t.queryParser.bind(t),t.resultSetFilter=t.resultSetFilter.bind(t),t))),a||[]),get path(){return s.path||{url:"",config:{}}},hasPagination:()=>Boolean(s&&s.paginationToken),getPaginationSpec:()=>s.paginationToken||{},getPaginationParamName(){const t=this.getPaginationSpec();return t.param||t.requestParam||"paginationToken"},buildPaginationKey(t,e,n){if(!e)return t;const r=e.split("&").filter(t=>!t.startsWith(`${n}=`));r.sort();const o=r.join("&");return o?`${t}?${o}`:t},getPaginationState:t=>u.get(t),setPaginationState(t,e){u.set(t,e)},clearPaginationState(t){u.delete(t)},hasMore(t){const e=u.get(t);return Boolean(e&&e.hasMore)},extractNextToken(t,e,n){const r=this.getPaginationSpec(),o=(t,e)=>{if(!t||!e)return;const n=e.split(".");let r=t;for(let t=0;t<n.length;t++){const e=n[t];if(!r||!Object.prototype.hasOwnProperty.call(r,e))return;r=r[e]}return r};if("function"==typeof r.responsePath)try{const o=r.responsePath,s=t=>{try{return t()}catch{return}},a=i(1===o.length,()=>o({data:t,extracted:e,headers:n}),2===o.length,()=>o(t,n),i.ELSE,()=>o(t,e,n))();if(void 0!==a)return a;const u=s(()=>o(t,n));if(void 0!==u)return u;const c=s(()=>o(t,e,n));if(void 0!==c)return c;const l=s(()=>o({data:t,extracted:e,headers:n}));return void 0!==l?l:void 0}catch{return}let s;return r.responseHeader&&(s=((t,e)=>{if(!t||!e)return;const n=String(e),r=n.toLowerCase();if("function"==typeof t.get){const e=t.get(n)??t.get(r);if(null!=e)return e}if("object"==typeof t&&!Array.isArray(t)){const e=t[n]??t[r];if(null!=e)return e}if(t instanceof Map){const e=t.get(n)??t.get(r);if(null!=e)return e}if(Array.isArray(t)){const e=t.find(([t])=>String(t).toLowerCase()===r);if(e)return e[1]}})(n,r.responseHeader),s)||r.responsePath&&(s=o(t,r.responsePath),null==s&&e&&e!==t&&(s=o(e,r.responsePath))),s}};const f=/{(.*?)}/g,p=/[{}]/g;function d(t){return Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])}).join("&")}function y(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function g(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?y(Object(n),!0).forEach(function(e){o(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}const h="object"==typeof process&&"object"==typeof process.versions&&void 0!==process.versions.node,m={get:(t,e)=>v(t,"GET",e),put:(t,e)=>v(t,"PUT",e),post:(t,e)=>v(t,"POST",e),delete:t=>v(t,"DELETE")};function b(t){return h&&l.hasNodeProvider()?(e=function(t){return l.hasDebug()&&O(t,g(g({method:t.method},t.body?{body:JSON.stringify(t.body)}:{}),t.headers?{headers:t.headers}:{})),l.getNodeProvider()}(t),async function(t,n=0,r,o){try{const i=await e(t,n,r,o);if(j(t,null==i?void 0:i.data,null==i?void 0:i.headers),null!=r&&r.hasPagination&&r.hasPagination()&&t.__paginationKey){const e=P(t,i.data,i.data,i.headers);return g(g({},i),{},{data:e})}return i}catch(e){try{return await w(t,n,r,o)}catch(t){throw e}}}):w;var e}function v(t,e,n){const r="GET"===e,{host:o,options:i}=function(t){const e=l.path.hasOwnProperty(t),n=function(t){return t&&t.length>1&&t.endsWith("/")?t.slice(0,-1):t}(e&&e.url||l.apiUrl);return{host:n,options:e&&e.options||l.options}}(t),s=r?function(t,e,n){if(!l.hasPagination())return{finalData:e};const r=l.getPaginationParamName(),o=d(e||{}),i=`${n}/${t}`,s=l.buildPaginationKey(i,o,r),a=l.getPaginationState(s),u=a&&a.token;return{finalData:u?g(g({},e||{}),{},{[r]:u}):e,paginationKey:s,paginationParam:r,token:u}}(t,n,o):{},a=function({url:t,method:e,data:n,finalData:r,host:o,options:i,pagination:s,isGetData:a}){const u=a?d(r||{}):"",c=g(g({method:e,url:`${o}/${t}${u?`?${u}`:""}`,json:!0},a?{}:{body:n}),i);if(s&&s.paginationKey)if(c.__paginationKey=s.paginationKey,c.__paginationParam=s.paginationParam,s.token){const t=String(s.token),e=t.length<=6?"***":`${t.slice(0,3)}***${t.slice(-3)}`;c.__paginationApplied=!0,c.__paginationTokenPreview=e}else c.__paginationApplied=!1;return c}({url:t,method:e,data:n,finalData:s.finalData||n,host:o,options:i,pagination:s,isGetData:r});return function(t,e,n){const r=()=>t(e,0,l,n);return l.hasPolicy(n)?l.getPolicy(n).execute(r):r()}(b(a),a,t)}function P(t,e,n,r){try{const o=t.__paginationKey,i=t.__paginationParam,s=l.getPaginationState(o),a=l.extractNextToken(e,n,r);if(a){if(l.setPaginationState(o,{token:a,hasMore:!0,param:i}),l.hasDebug()){const t=String(a),e=t.length<=6?"***":`${t.slice(0,3)}***${t.slice(-3)}`;console.log("[querty][debug] pagination: stored next token",{key:o,param:i,token:e})}return n}return s&&s.token?(l.hasDebug()&&console.log("[querty][debug] pagination: end of pages (clearing state)",{key:o,param:i}),l.clearPaginationState(o),Array.isArray(n),[]):n}catch(t){return n}}function O(t,e){const n=t.__paginationKey?{key:t.__paginationKey,param:t.__paginationParam,applied:Boolean(t.__paginationApplied),token:t.__paginationTokenPreview||void 0}:void 0;console.log("[querty][debug] api request:",g({url:t.url,options:e},n?{pagination:n}:{}))}function j(t,e,n){if(!l.hasDebug()||!l.hasDebugResponseRaw())return;let r=n;try{if(n&&"function"==typeof n.entries){const t={};for(const[e,r]of n.entries())t[e]=r;r=t}}catch(t){}console.log("[querty][debug] api response:",{url:t.url,status:void 0,headers:r,raw:e})}async function w(t,e=0,n,r){const o=function(t){let e,n;return l.hasCancel()&&(e=new AbortController,n=e.signal,l.cancel=e),g(g(g({method:t.method},n?{signal:n}:{}),t.body?{body:JSON.stringify(t.body)}:{}),t.headers?{headers:t.headers}:{})}(t);!function(t,e){if(l.hasDebug()){const n=g({},t);n.signal&&(n.signal="[AbortSignal]"),O(e,n)}}(o,t);const i=await fetch(t.url,o);if(function(t,e){return 401===t&&0===e&&l.hasRefresh()}(i.status,e)){const e=await async function(t,e){await l.refresh(e);const n=l.path.hasOwnProperty(e),r=n&&n.options||l.options;return g(g({},t),{},{headers:r.headers})}(t,r);return w(e,1,n,r)}return async function(t,e){const n=await t.json();j(e,n,t.headers);let r=l.dataExtractor(n);return l.hasPagination()&&e.__paginationKey&&(r=P(e,n,r,t.headers)),{status:t.status,data:r}}(i,t)}function S(t){return t.trim()}function E(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function A(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?E(Object(n),!0).forEach(function(e){o(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):E(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}const D=/[()']/g,N=/\bJOIN\b|\bLEFT\s+JOIN\b|\bFULL\s+JOIN\b/gi,_=/\bJOIN\b|\bLEFT\s+JOIN\b|\bFULL\s+JOIN\b|\bON\b/i;function L(t){const{fieldsStr:e,fromSegment:n,whereSegment:r,groupByStr:o,havingStr:i,orderByStr:s}=function(t){const e=new RegExp([/^\s*SELECT\s+([\s\S]*?)/,/\s+FROM\s+([\s\S]*?)/,/(?:\s+WHERE\s+([\s\S]*?))?/,/(?:\s+GROUP\s+BY\s+([\s\S]*?))?/,/(?:\s+HAVING\s+([\s\S]*?))?/,/(?:\s+ORDER\s+BY\s+([\s\S]*?))?\s*$/].map(t=>t.source).join(""),"i"),n=t.match(e);if(!n)throw new Error("Invalid or unsupported SELECT query format");const r=(n[1]||"").trim(),o=(n[2]||"").trim(),i=n[3]?n[3].trim():void 0,s=n[4]?n[4].trim():void 0,a=n[5]?n[5].trim():void 0,u=n[6]?n[6].trim():void 0;return{fieldsStr:r,fromSegment:o,whereSegment:i,groupByStr:s,havingStr:a,orderByStr:u}}(t),a=function(t){return k(t)}(e),u=function(t){return t?k(t):void 0}(o),c=function(t){if(!t)return;const e=t.split(",").map(t=>t.trim()).filter(Boolean);return e.map(t=>{var e;const n=t.split(/\s+/).filter(Boolean),r=null===(e=n[n.length-1])||void 0===e?void 0:e.toUpperCase();let o="ASC";"ASC"!==r&&"DESC"!==r||(n.pop(),o=r);return{field:n.join(" ").trim(),direction:o}})}(s),{joinMatch:l,tables:f,joinCond:p,join:d}=function(t){const e=t.match(N);if(e){const[n,...r]=t.split(_),{joinTables:o,clauses:i}=r.reduce((t,e,n)=>(t[n%2==0?"joinTables":"clauses"].push(e.trim()),t),{joinTables:[n.trim()],clauses:[]});return{joinMatch:e,tables:o.map(S),joinCond:function(t){const e=[];for(let n=0;n<t.length;n++){const r=t[n],[o,i]=r.split("="),[,s]=o.split(".").map(S),[,a]=i.split(".").map(S);e.push([s,a])}return e}(i),join:e}}return{joinMatch:null,tables:t,joinCond:void 0,join:void 0}}(n),y=function(t){let e,n;if(t&&t.length>0){const r=t.match(/^(.*?)\s+IN\s*\(([\s\S]*?)\)\s*$/i);if(r){return{field:r[1].trim(),operator:"IN",values:$(`(${r[2].trim()})`)}}const o=t.indexOf("=");-1!==o&&(e=t.slice(0,o).trim(),n=t.slice(o+1).trim())}return{field:e,value:n}}(r),g=(()=>{if(!(r||l||u||i||c))return;const t={};return"IN"===(null==y?void 0:y.operator)?(t.operator="IN",t.values=y.values,y.field&&(t[y.field]=y.values)):null!=y&&y.field&&(t.value=y.value,t[y.field]=y.value),A(A({},t),{},{join:d,joinCond:p,groupBy:u,having:null==i?void 0:i.trim(),orderBy:c})})();return A({entities:l?f:k(f),fields:a},g?{conditions:g}:{})}function k(t){return t.split(",").map(S)}function T(t){const e=t.split(/INSERT INTO \b(\w+)\b|\bVALUES\b/i),n=e[2].replace(D,"").split(",").map(S);const r=$(e[4]);return{entity:e[1],data:n.reduce((t,e,n)=>(t[e]=r[n],t),{})}}function C(t){const e=new RegExp([/^s*UPDATEs+(\w+)/,/s+SETs+(.*?)/,/s+WHEREs+(.*)$/].map(t=>t.source.replace(/s/g,"\\s")).join(""),"i"),n=t.match(e);if(!n)throw new Error("Invalid or unsupported UPDATE query format");const r=n[1],o=n[2],i=n[3],s=function(t,e){return Object.fromEntries([...t.matchAll(e)].map(([,t,e,n])=>{const r=void 0!==e?e:n,o=r&&!isNaN(r)&&""!==r.trim()?Number(r):r;return[t.trim(),o]}))}(o,/(\w+)\s*=\s*(?:'([^']*)'|(\S+?))(?:,|$)/g),a=i.split("=")[1].trim();return{entity:r.trim(),data:s,id:a}}function $(t){return t.trim().slice(1,-1).split(",").map(t=>{const e=t.trim();if(e.startsWith("'")&&e.endsWith("'"))return e.slice(1,-1);if(!isNaN(e)&&""!==e.trim())return Number(e);return"null"===e.toLowerCase()?null:e})}function R(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var B,x,q,I,M,U;function F(){if(x)return B;x=1,B=function(i){return t.test(i)?i.toLowerCase():e.test(i)?(function(t){return t.replace(r,function(t,e){return e?" "+e:""})}(i)||i).toLowerCase():n.test(i)?function(t){return t.replace(o,function(t,e,n){return e+" "+n.toLowerCase().split("").join(" ")})}(i).toLowerCase():i.toLowerCase()};var t=/\s/,e=/(_|-|\.|:)/,n=/([a-z][A-Z]|[A-Z][a-z])/;var r=/[\W_]+(.|$)/g;var o=/(.)([A-Z]+)/g;return B}var J,W=R(function(){if(U)return M;U=1;var t=function(){if(I)return q;I=1;var t=F();return q=function(e){return t(e).replace(/[\W_]+(.|$)/g,function(t,e){return e?" "+e:""}).trim()}}();return M=function(e){return t(e).replace(/\s(\w)/g,function(t,e){return e.toUpperCase()})}}()),K={};var H=function(){if(J)return K;J=1,Object.defineProperty(K,"__esModule",{value:!0}),K.fullJoin=K.leftJoin=K.join=void 0;const t=(t,e)=>{const n=new Map;for(const r of t){const t=e(r);if(n.has(t)){const e=n.get(t);e.push(r),n.set(t,e)}else n.set(t,[r])}return n},e=(e,n,r,o,i,s,a)=>{const u=t(e,r);if(!a&&0===u.size)return[];const c=t(n,o);if(!s&&0===c.size)return[];const l=[];for(const t of u.keys())if(c.has(t)){const e=u.get(t),n=c.get(t);e.forEach(t=>n.forEach(e=>l.push(i(t,e))))}else if(s){u.get(t).forEach(t=>l.push(i(t,void 0)))}if(a)for(const t of c.keys())if(!u.has(t)){c.get(t).forEach(t=>l.push(i(void 0,t)))}return l};return K.join=(t,n,r,o,i)=>e(t,n,r,o,(t,e)=>i(t,e),!1,!1),K.leftJoin=(t,n,r,o,i)=>e(t,n,r,o,(t,e)=>i(t,e),!0,!1),K.fullJoin=(t,n,r,o,i)=>e(t,n,r,o,(t,e)=>i(t,e),!0,!0),K}();function G(t){return Array.isArray(t)?t:[t]}function z(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function Y(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?z(Object(n),!0).forEach(function(e){o(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):z(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}const Z="fullJoin",V="DESC",Q="IN",X="=",tt=".",et=/\s+AS\s+/i,nt="->",rt="id",ot="data",it="*",st=t=>{const e=t.match(et);if(!e)return[t];const n=e.index;return[t.slice(0,n).trim(),t.slice(n+e[0].length).trim()]},at=t=>st(t)[0],ut=(t,e)=>{const n=Y(Y({},t),e);return t&&t[rt]?Y(Y({},n),{},{[rt]:t[rt]}):n},ct=(t,e)=>Y(Y({},t),e);function lt(t,e,n,r={},o){var s,a;const u=function(t,e,n,r){const o=1===t.length;return t.reduce((t,s,a)=>{const u=function(t,e,n){const r=t[e][ot];if(Array.isArray(r))return r;if(r&&"object"==typeof r&&Object.prototype.hasOwnProperty.call(r,n)){const t=r[n];return Array.isArray(t)?t:[t]}return[r]}(e,a,s),[c]=u;return t[s]=c?function(t,e,n,r,o,s){const a=gt(t,e);if(u=a,u.includes(it))return o;var u;const c=a.map(t=>at(t)).filter(t=>t!==it&&!t.includes(tt)),l=function(t,e,n){const r=t=>"string"==typeof t&&t.includes(nt);return t?[...new Set(e)]:(()=>{const t=new Set(n.flatMap(t=>t&&"object"==typeof t?Object.keys(t):[]));return[...new Set(e.filter(e=>t.has(e)||r(e)))]})()}(s,c,o),f=r?[...new Set(r.flat())]:[];return function(t,e,n){const r=function(t){return t.reduce((t,e)=>{if(et.test(e)){const[n,r]=st(e);t[n]=r}return t},{})}(e);return n.map(e=>t.reduce((t,n)=>{if("string"==typeof(o=n)&&o.includes(nt)){return t[r[n]||function(t){const e=t.match(mt);if(e)return e[2];const n=t.indexOf(nt);return n>0?t.slice(0,n).trim():t}(n)]=function(t,e){const{base:n,steps:r}=function(t){const e=t.indexOf(nt),n=t.slice(0,e).trim(),r=t.slice(e),o=[];let i;for(;i=ht.exec(r);)o.push({op:"->>"===i[1]?"text":"json",key:i[3]});return{base:n,steps:o}}(e);let o=t?t[n]:void 0;for(let t=0;t<r.length;t++){const{op:e,key:n}=r[t];if(null==o)return null;const s=i(()=>Array.isArray(o)&&/^\d+$/.test(n),()=>o[Number(n)],()=>o&&"object"==typeof o,()=>o[n],i.ELSE,void 0)();o=i("json"===e,s,i.ELSE,()=>null==s?null:String(s))()}return null==o?null:o}(e,n),t}var o;return t[r[n]||n]=Object.prototype.hasOwnProperty.call(e,n)?e[n]:null,t},{}))}([...l,...f],a,o)}(n,s,0,r,u,o):[],t},{})}(e,t,n,null==r?void 0:r.joinCond),c=null!=r&&r.join?function(t,e){const{join:n,joinCond:r}=t,o=Object.values(e).map(G),[i,...s]=o;return s.reduce((t,e,o)=>{const i=(s=n[o],W(s.replace(/\s/,"_")));var s;const[a,u]=r[o];var c;return((t,e,n,r,o,i)=>t(e,n,t=>t[r],t=>t[o],i))("leftJoin"===(c=i)?H.leftJoin:c===Z?H.fullJoin:H.join,t,e,a,u,o>0&&i===Z?ct:ut)},i)}(r,u):u,l=[(null==r||null===(s=r.groupBy)||void 0===s?void 0:s.length)>0?t=>function(t,e,n){return t.join?function(t,e){if(!Array.isArray(t))return t;const n=e.map(t=>t.includes(tt)?t.split(tt)[1]:t);return yt(t,n)}(e,t.groupBy):function(t,e,n){return e.reduce((e,r)=>{const o=t[r];if(Array.isArray(o)){const t=gt(n,r).map(t=>at(t));e[r]=yt(o,t)}else e[r]=o;return e},{})}(e,n,t.groupBy)}(r,t,e):null,!(null==r||!r.having)&&(t=>function(t,e,n,r){const o=function(t){if(!t)return;const e=t.match(/^(.*?)\s+IN\s*\(([^)]*)\)\s*$/i);if(e){const t=e[1].trim(),n=e[2].trim(),r=n.split(",").map(t=>dt(t.trim()));return{field:t,operator:Q,values:r}}const n=t.indexOf(X);if(-1!==n){const e=t.slice(0,n).trim(),r=t.slice(n+1).trim();return{field:e,operator:X,value:dt(r)}}return}(n);if(!o)return t;if(r)return function(t,e){if(!Array.isArray(t))return t;const n=e.field.includes(tt)?e.field.split(tt)[1]:e.field;return t.filter(t=>pt(null==t?void 0:t[n],e))}(t,o);{const n=o.field.includes(tt)?o.field.split(tt)[0]:null,r=o.field.includes(tt)?o.field.split(tt)[1]:o.field;return e.reduce((e,i)=>{const s=t[i];return e[i]=!Array.isArray(s)||n&&n!==i?s:s.filter(t=>pt(null==t?void 0:t[r],o)),e},{})}}(t,e,r.having,Boolean(r.join))),(null==r||null===(a=r.orderBy)||void 0===a?void 0:a.length)>0&&(t=>function(t,e,n,r){return r?function(t,e){if(!Array.isArray(t))return t;const n=e.map(t=>({key:t.field.includes(tt)?t.field.split(tt)[1]:t.field,dir:t.direction}));return ft(t.slice(),n)}(t,n):e.reduce((e,r)=>{const o=t[r];if(!Array.isArray(o))return e[r]=o,e;const i=function(t,e){return t.reduce((t,n)=>{if(n.field.includes(tt)){const[r,o]=n.field.split(tt);r===e&&t.push({key:o,dir:n.direction})}else t.push({key:n.field,dir:n.direction});return t},[])}(n,r);return e[r]=i.length>0?ft(o.slice(),i):o,e},{})}(t,e,r.orderBy,Boolean(r.join))),o].filter(Boolean);return l.reduce((t,e)=>e(t),c)}function ft(t,e){if(!e||0===e.length)return t;const n=(t,e,n)=>i(null==t&&null==e,0,null==t,1,null==e,-1,t<e,n===V?1:-1,t>e,n===V?-1:1,i.ELSE,0)();return t.sort((t,r)=>{for(let o=0;o<e.length;o++){const{key:i,dir:s}=e[o],a=null==t?void 0:t[i],u=null==r?void 0:r[i],c=n(a,u,s);if(0!==c)return c}return 0})}function pt(t,e){return e.operator===Q?e.values.some(e=>e===t):String(t)===String(e.value)}function dt(t){if(!t)return t;if(t.startsWith("'")&&t.endsWith("'")||t.startsWith('"')&&t.endsWith('"'))return t.slice(1,-1);return"null"===t.toLowerCase()?null:isNaN(t)||""===t.trim()?t:Number(t)}function yt(t,e){if(!e||0===e.length)return t;const n=t.reduce((t,n)=>{const r=e.map(t=>String(null==n?void 0:n[t])).join("|#|");return t.has(r)||t.set(r,n),t},new Map);return Array.from(n.values())}function gt(t,e){return t.reduce((t,n)=>{const[r,o]=n.split(tt);return t.push(r===e?o:n),t},[])}const ht=/(->>|->)\s*(["'])(.*?)\2/g;const mt=/(["'])([^"']+)\1\s*$/;const bt=(...t)=>e=>t.reduceRight((t,e)=>e(t),e);const vt={[t.select]:async function(t,e,n={}){const{queryParser:r,resultSetFilter:o}=n,{fields:i,entities:s,conditions:a}=r(L(t));return lt(await Promise.all(s.map(t=>{const n=function(t={},e){const n=l.getNestedRoute(e,t);return n||(t.value?`${e}/${t.value}`:e)}(a,t);return m.get(n,e)})),s,i,a,o)},[t.insert]:async function(t,e){const n={},{entity:r,queryData:o}=function(t,e){let n,r;if(t)n=e.replace(/INSERT INTO/i,"").trim(),r=t;else{const t=T(e);n=t.entity,r=t.data}return{entity:n,queryData:r}}(e,t),i=await m.post(r,o);return n[r]?n[r].push(i.data):n[r]=[i.data],n},[t.update]:async function(t,e){const n={},{entity:r,queryData:o,id:i}=function(t,e){let n,r,o;if(t){const[,i,s]=e.split(/UPDATE\b|\bWHERE\b/i);o=s.split("=")[1].trim(),n=i.trim(),r=t}else{const t=C(e);n=t.entity,r=t.data,o=t.id}return{entity:n,queryData:r,id:o}}(e,t),s=await m.put(`${r}/${i}`,o);return n[r]=s.data,n},[t.delete]:async function(t){const{entity:e,id:n}=function(t){const e=new RegExp([/^s*DELETEs+FROMs+(\w+)/,/s+WHEREs+(.*)$/].map(t=>t.source.replace(/s/g,"\\s")).join(""),"i"),n=t.match(e);if(!n)throw new Error("Invalid or unsupported DELETE query format");return{entity:n[1],id:n[2].split("=")[1].trim()}}(t);return await m.delete(`${e}/${n}`),{id:n}}};async function Pt(n,r){const[o]=function(t){return t.replace(e,"").split(" ")}(n),i=t[o.toLowerCase()],s=function(){let t=t=>t,e=t=>t;if(l.hasAddons()){const{queryParsers:n,resultSetFilters:r}=l.getAddons().reduce((t,{queryParser:e,resultSetFilter:n})=>(t.queryParsers.push(e),t.resultSetFilters.push(n),t),{queryParsers:[],resultSetFilters:[]});t=bt(...n),e=bt(...r)}return{queryParser:t,resultSetFilter:e}}();return vt[i](n,r,s)}export{i as cond,Pt as exec,c as setConfig};
